<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <form onsubmit="addNewExpense(event)">
        <label for="expenseamount">Choose expenseamount:</label>
        <input type="number" name="expenseamount" required> </input>
        <label for="description">Choose description:</label>
        <input type="text" name="description" required> </input>
        <label for="category">Choose a category:</label>
        <select id="category" name="category">
            <option value="fuel">fuel</option>
            <option value="food">food</option>
            <option value="electricity">electricity</option>
            <option value="Movie">Movie</option>
        </select>
        <button>Add Expense</button>
    </form>
    <div id="message"></div>
    <h1>
        Expenses
    </h1>
    <ul id='listOfExpenses'>

    </ul>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        function addNewExpense(e) {
            e.preventDefault();

            const expenseDetails = {
                expenseamount: e.target.expenseamount.value,
                description: e.target.description.value,
                category: e.target.category.value,

            }
            console.log(expenseDetails)
            axios.post('http://localhost:3000/expense/addexpense', expenseDetails)
                .then((response) => {

                    addNewExpensetoUI(response.data.expense);

                }).catch(err => showError(err))

        }

        window.addEventListener('DOMContentLoaded', () => {
            
            axios.get('http://localhost:3000/expense/getexpenses').then(response => {
                    response.data.expenses.forEach(expense => {
                        addNewExpensetoUI(expense);
                    })
                }).catch(err => {
                    showError(err)
                })
        });

        function addNewExpensetoUI(expense) {
            console.log(expense)
            const parentElement = document.getElementById('listOfExpenses');
            const expenseElemId = `expense-${expense.id}`;
            parentElement.innerHTML += `
        <li id=${expenseElemId}>
            ${expense.expenseamount} - ${expense.category} - ${expense.description}
            <button onclick='deleteExpense(event, ${expense.id})'>
                Delete Expense
            </button>
        </li>`
        }

        function deleteExpense(e, expenseid) {
            axios.delete(`http://localhost:3000/expense/deleteexpense/${expenseid}`).then(() => {

                removeExpensefromUI(expenseid);

            }).catch((err => {
                showError(err);
            }))
        }

        function showError(err) {
            document.body.innerHTML += `<div style="color:red;"> ${err}</div>`
        }
        

        function removeExpensefromUI(expenseid) {
            const expenseElemId = `expense-${expenseid}`;
            document.getElementById(expenseElemId).remove();
        }

    </script>
</body>

</html>